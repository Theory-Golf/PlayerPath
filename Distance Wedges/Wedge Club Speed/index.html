<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club Speed Performance Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --ivory: #fafaf8;
            --cream: #f5f4f0;
            --charcoal: #2c3333;
            --forest: #2d5016;
            --forest-light: #3d6b22;
            --gold: #b8956a;
            --gold-dark: #9a7a55;
            --sand: #d4c5b0;
            --rust: #8b5a3c;
            --text-primary: #2c3333;
            --text-secondary: #6b7280;
            --border-light: #e8e6e1;
            --shadow-sm: rgba(44, 51, 51, 0.06);
            --shadow-md: rgba(44, 51, 51, 0.1);
            --shadow-lg: rgba(44, 51, 51, 0.15);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--ivory);
            color: var(--text-primary);
            line-height: 1.7;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 4rem;
            padding: 3rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .header h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 3.5rem;
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 400;
            letter-spacing: 0.02em;
            text-transform: uppercase;
            font-size: 0.875rem;
        }

        .card {
            background: white;
            border-radius: 2px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-light);
            box-shadow: 0 1px 3px var(--shadow-sm);
        }

        .card h2 {
            font-family: 'Cormorant Garamond', serif;
            color: var(--charcoal);
            margin-bottom: 2rem;
            font-size: 2rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .level-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .level-btn {
            background: white;
            border: 1.5px solid var(--border-light);
            color: var(--text-primary);
            padding: 1.5rem 1rem;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 0.875rem;
            position: relative;
            overflow: hidden;
        }

        .level-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--forest);
            transform: scaleX(0);
            transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .level-btn:hover {
            border-color: var(--forest);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-md);
        }

        .level-btn:hover::before {
            transform: scaleX(1);
        }

        .level-btn.active {
            border-color: var(--forest);
            background: linear-gradient(to bottom, #fafaf8, #f8f7f4);
            box-shadow: 0 2px 8px var(--shadow-md);
        }

        .level-btn.active::before {
            transform: scaleX(1);
        }

        .level-btn .level-number {
            display: block;
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--charcoal);
        }

        .level-btn .threshold {
            display: block;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            margin-top: 0.25rem;
        }

        .level-btn .name {
            display: block;
            color: var(--forest);
            font-size: 0.85rem;
            font-weight: 500;
            margin-top: 0.5rem;
        }

        .input-group {
            margin-bottom: 1.75rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.625rem;
            color: var(--charcoal);
            font-weight: 500;
            font-size: 0.875rem;
            letter-spacing: 0.01em;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--cream);
            border: 1px solid var(--border-light);
            border-radius: 2px;
            color: var(--text-primary);
            font-size: 0.9375rem;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--forest);
            background: white;
            box-shadow: 0 0 0 3px rgba(45, 80, 22, 0.08);
        }

        .distance-section {
            background: var(--cream);
            padding: 2rem;
            border-radius: 2px;
            margin-bottom: 1.75rem;
            border: 1px solid var(--border-light);
        }

        .distance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .distance-label {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--charcoal);
            letter-spacing: -0.01em;
        }

        .distance-input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .distance-input-wrapper input {
            width: 100px;
            padding: 0.625rem 0.875rem;
            text-align: center;
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 2px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.9375rem;
        }

        .distance-input-wrapper span {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .shot-input-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.25rem;
        }

        .shot-input label {
            display: block;
            text-align: center;
            margin-bottom: 0.625rem;
            color: var(--text-secondary);
            font-size: 0.8125rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .shot-input input {
            width: 100%;
            padding: 0.875rem 0.5rem;
            text-align: center;
            font-size: 1.125rem;
            font-weight: 600;
            background: white;
            border: 1.5px solid var(--border-light);
            border-radius: 2px;
            color: var(--text-primary);
            transition: all 0.2s ease;
            margin-bottom: 0.625rem;
        }

        .shot-input input:focus {
            outline: none;
            border-color: var(--forest);
            box-shadow: 0 0 0 3px rgba(45, 80, 22, 0.08);
        }

        .shot-input select {
            width: 100%;
            padding: 0.5rem;
            text-align: center;
            font-size: 0.8125rem;
            font-weight: 500;
            background: white;
            border: 1px solid var(--border-light);
            border-radius: 2px;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .shot-input select:focus {
            outline: none;
            border-color: var(--forest);
            box-shadow: 0 0 0 2px rgba(45, 80, 22, 0.06);
        }

        .shot-input input.success {
            border-color: var(--forest);
            background: rgba(45, 80, 22, 0.04);
        }

        .shot-input input.failure {
            border-color: var(--rust);
            background: rgba(139, 90, 60, 0.04);
        }

        .btn {
            background: var(--forest);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 2px;
            font-weight: 500;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.01em;
        }

        .btn:hover {
            background: var(--forest-light);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: white;
            color: var(--charcoal);
            border: 1.5px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: var(--cream);
            border-color: var(--charcoal);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--cream);
            padding: 2rem 1.5rem;
            border-radius: 2px;
            border: 1px solid var(--border-light);
            text-align: center;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.8125rem;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.075em;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 600;
            font-family: 'Cormorant Garamond', serif;
            letter-spacing: -0.02em;
        }

        .stat-value.success { color: var(--forest); }
        .stat-value.warning { color: var(--gold-dark); }
        .stat-value.danger { color: var(--rust); }

        .assessment {
            padding: 2rem;
            border-radius: 2px;
            border-left: 3px solid;
            margin-top: 2rem;
            background: white;
        }

        .assessment.passed {
            background: rgba(45, 80, 22, 0.04);
            border-color: var(--forest);
        }

        .assessment.conditional {
            background: rgba(184, 149, 106, 0.08);
            border-color: var(--gold-dark);
        }

        .assessment.failed {
            background: rgba(139, 90, 60, 0.04);
            border-color: var(--rust);
        }

        .assessment h3 {
            margin-bottom: 0.875rem;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .assessment p {
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .history-list {
            list-style: none;
        }

        .history-item {
            background: var(--cream);
            padding: 1.5rem;
            border-radius: 2px;
            margin-bottom: 1rem;
            border: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            box-shadow: 0 2px 8px var(--shadow-sm);
            transform: translateY(-1px);
        }

        .history-item .date {
            color: var(--text-secondary);
            font-size: 0.8125rem;
            font-weight: 400;
        }

        .history-item .success-rate {
            font-weight: 600;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
        }

        .session-info-box {
            background: var(--cream);
            padding: 1.5rem;
            border-radius: 2px;
            border: 1px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .session-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.25rem;
            font-size: 0.875rem;
        }

        .session-info-item {
            display: flex;
            flex-direction: column;
        }

        .session-info-label {
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        .session-info-value {
            color: var(--charcoal);
            font-weight: 600;
        }

        .session-info-value.highlight {
            color: var(--forest);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container { 
                padding: 2rem 1rem; 
            }
            .header h1 { 
                font-size: 2.5rem; 
            }
            .card {
                padding: 1.5rem;
            }
            .shot-input-grid { 
                grid-template-columns: repeat(5, 1fr);
                gap: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Club Speed Tracker</h1>
            <p>Performance Analysis • Distance Control Excellence</p>
        </div>

        <div class="card">
            <h2>Skill Level</h2>
            <div class="level-selector" id="levelSelector"></div>
        </div>

        <div class="card">
            <h2>Session Configuration</h2>
            <div class="input-group">
                <label>Wedge Selection</label>
                <select id="clubSelect">
                    <option value="60">60° Lob Wedge</option>
                    <option value="56" selected>56° Sand Wedge</option>
                    <option value="50">50° Gap Wedge</option>
                    <option value="46">46° Pitching Wedge</option>
                </select>
            </div>
        </div>

        <div class="card">
            <h2>Performance Data Entry</h2>
            <p style="color: var(--text-secondary); margin-bottom: 2rem; font-size: 0.9375rem;" id="targetInfo"></p>
            
            <div class="distance-section">
                <div class="distance-header">
                    <span class="distance-label">Distance 1</span>
                    <div class="distance-input-wrapper">
                        <input type="number" id="distance1" value="60" min="50" max="120">
                        <span>yards</span>
                    </div>
                </div>
                <div class="shot-input-grid" id="distance1Grid"></div>
            </div>

            <div class="distance-section">
                <div class="distance-header">
                    <span class="distance-label">Distance 2</span>
                    <div class="distance-input-wrapper">
                        <input type="number" id="distance2" value="75" min="50" max="120">
                        <span>yards</span>
                    </div>
                </div>
                <div class="shot-input-grid" id="distance2Grid"></div>
            </div>

            <div class="distance-section">
                <div class="distance-header">
                    <span class="distance-label">Distance 3</span>
                    <div class="distance-input-wrapper">
                        <input type="number" id="distance3" value="90" min="50" max="120">
                        <span>yards</span>
                    </div>
                </div>
                <div class="shot-input-grid" id="distance3Grid"></div>
            </div>

            <div style="margin-top: 2.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                <button class="btn" onclick="calculateResults()">Analyze Session</button>
                <button class="btn btn-secondary" onclick="resetSession()">Clear Data</button>
                <button class="btn btn-secondary" onclick="startNewSession()">New Session</button>
            </div>
        </div>

        <div id="resultsSection" class="hidden">
            <div class="card">
                <h2>Session Analysis</h2>
                
                <div class="session-info-box">
                    <div class="session-info-grid">
                        <div class="session-info-item">
                            <span class="session-info-label">Skill Level</span>
                            <strong id="sessionLevel" class="session-info-value highlight"></strong>
                        </div>
                        <div class="session-info-item">
                            <span class="session-info-label">Wedge</span>
                            <strong id="sessionClub" class="session-info-value"></strong>
                        </div>
                        <div class="session-info-item">
                            <span class="session-info-label">Distances</span>
                            <strong id="sessionDistances" class="session-info-value"></strong>
                        </div>
                        <div class="session-info-item">
                            <span class="session-info-label">Session Date</span>
                            <strong id="sessionDate" class="session-info-value"></strong>
                        </div>
                    </div>
                </div>

                <div class="stats-grid" id="statsGrid"></div>
                <div id="assessmentDiv"></div>
            </div>

            <div class="card" id="historyCard">
                <h2>Performance History</h2>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9375rem;">
                    Complete session archive, most recent first
                </p>
                <ul class="history-list" id="historyList"></ul>
            </div>
        </div>
    </div>

    <script>
        const LEVELS = [
            { level: 1, name: 'Foundation', threshold: 5.0, description: 'High handicap baseline' },
            { level: 2, name: 'Developing', threshold: 4.0, description: 'Mid handicap target' },
            { level: 3, name: 'Competent', threshold: 3.0, description: 'Single digit handicap' },
            { level: 4, name: 'Advanced', threshold: 2.0, description: 'Low single digit/scratch' },
            { level: 5, name: 'Expert', threshold: 1.5, description: 'Collegiate/mini-tour' },
            { level: 6, name: 'Tour Pro', threshold: 1.0, description: 'PGA Tour average' }
        ];

        let currentLevel = 1;
        let sessionHistory = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadHistory();
            renderLevelSelector();
            renderShotInputs();
            updateTargetInfo();
        });

        function loadHistory() {
            const saved = localStorage.getItem('clubSpeedHistory');
            if (saved) {
                sessionHistory = JSON.parse(saved);
            }
        }

        function saveHistory() {
            localStorage.setItem('clubSpeedHistory', JSON.stringify(sessionHistory));
        }

        function renderLevelSelector() {
            const selector = document.getElementById('levelSelector');
            selector.innerHTML = LEVELS.map(level => `
                <button class="level-btn ${currentLevel === level.level ? 'active' : ''}" 
                        onclick="selectLevel(${level.level})">
                    <span class="level-number">L${level.level}</span>
                    <span class="name">${level.name}</span>
                    <span class="threshold">±${level.threshold} mph</span>
                </button>
            `).join('');
        }

        function selectLevel(level) {
            currentLevel = level;
            renderLevelSelector();
            updateTargetInfo();
            updateAllShotValidation();
        }

        function renderShotInputs() {
            const smashFactorOptions = [];
            for (let sf = 0.70; sf <= 1.20; sf += 0.01) {
                smashFactorOptions.push(sf.toFixed(2));
            }
            
            const smashFactorOptionsHTML = smashFactorOptions.map(sf => 
                `<option value="${sf}">${sf}</option>`
            ).join('');
            
            for (let d = 1; d <= 3; d++) {
                const grid = document.getElementById(`distance${d}Grid`);
                grid.innerHTML = Array.from({length: 5}, (_, i) => `
                    <div class="shot-input">
                        <label>Shot ${i + 1}</label>
                        <input type="number" id="d${d}shot${i}" step="0.1" placeholder="mph" 
                               oninput="updateShotValidation(${d}, ${i})">
                        <select id="d${d}smash${i}">
                            <option value="">Smash</option>
                            ${smashFactorOptionsHTML}
                        </select>
                    </div>
                `).join('');
            }
        }

        function updateTargetInfo() {
            const level = LEVELS[currentLevel - 1];
            const info = document.getElementById('targetInfo');
            info.innerHTML = `<strong>Objective:</strong> Maintain standard deviation ≤ ${level.threshold} mph across all 15 shots`;
        }

        function updateShotValidation(distance, shotIndex) {
            const allSpeeds = getAllSpeeds();
            if (allSpeeds.length < 3) return;
            
            const mean = allSpeeds.reduce((a, b) => a + b, 0) / allSpeeds.length;
            const input = document.getElementById(`d${distance}shot${shotIndex}`);
            const value = parseFloat(input.value);
            
            input.classList.remove('success', 'failure');
            if (!isNaN(value) && input.value !== '') {
                const deviation = Math.abs(value - mean);
                if (deviation <= 2) {
                    input.classList.add('success');
                } else if (deviation > 4) {
                    input.classList.add('failure');
                }
            }
        }

        function updateAllShotValidation() {
            for (let d = 1; d <= 3; d++) {
                for (let s = 0; s < 5; s++) {
                    updateShotValidation(d, s);
                }
            }
        }

        function getAllSpeeds() {
            const speeds = [];
            for (let d = 1; d <= 3; d++) {
                for (let s = 0; s < 5; s++) {
                    const value = document.getElementById(`d${d}shot${s}`).value;
                    if (value !== '') {
                        speeds.push(parseFloat(value));
                    }
                }
            }
            return speeds;
        }

        function getAllSmashFactors() {
            const smashFactors = [];
            for (let d = 1; d <= 3; d++) {
                for (let s = 0; s < 5; s++) {
                    const speedValue = document.getElementById(`d${d}shot${s}`).value;
                    const smashValue = document.getElementById(`d${d}smash${s}`).value;
                    if (speedValue !== '' && smashValue !== '') {
                        smashFactors.push(parseFloat(smashValue));
                    }
                }
            }
            return smashFactors;
        }

        function getSpeedsByDistance() {
            const byDistance = {};
            for (let d = 1; d <= 3; d++) {
                const speeds = [];
                for (let s = 0; s < 5; s++) {
                    const value = document.getElementById(`d${d}shot${s}`).value;
                    if (value !== '') {
                        speeds.push(parseFloat(value));
                    }
                }
                byDistance[d] = speeds;
            }
            return byDistance;
        }

        function getSmashFactorsByDistance() {
            const byDistance = {};
            for (let d = 1; d <= 3; d++) {
                const smashFactors = [];
                for (let s = 0; s < 5; s++) {
                    const speedValue = document.getElementById(`d${d}shot${s}`).value;
                    const smashValue = document.getElementById(`d${d}smash${s}`).value;
                    if (speedValue !== '' && smashValue !== '') {
                        smashFactors.push(parseFloat(smashValue));
                    }
                }
                byDistance[d] = smashFactors;
            }
            return byDistance;
        }

        function calculateSD(values) {
            if (values.length === 0) return 0;
            const mean = values.reduce((a, b) => a + b, 0) / values.length;
            const variance = values.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / values.length;
            return Math.sqrt(variance);
        }

        function startNewSession() {
            resetSession();
        }

        function calculateResults() {
            const allSpeeds = getAllSpeeds();
            if (allSpeeds.length < 5) {
                alert('Please enter at least 5 club speed values');
                return;
            }

            const level = LEVELS[currentLevel - 1];
            const club = parseInt(document.getElementById('clubSelect').value);
            const distances = [
                parseInt(document.getElementById('distance1').value),
                parseInt(document.getElementById('distance2').value),
                parseInt(document.getElementById('distance3').value)
            ];

            const overallMean = allSpeeds.reduce((a, b) => a + b, 0) / allSpeeds.length;
            const overallSD = calculateSD(allSpeeds);

            const allSmashFactors = getAllSmashFactors();
            let smashFactorMean = null;
            let smashFactorSD = null;
            if (allSmashFactors.length > 0) {
                smashFactorMean = (allSmashFactors.reduce((a, b) => a + b, 0) / allSmashFactors.length).toFixed(2);
                smashFactorSD = calculateSD(allSmashFactors).toFixed(3);
            }

            const byDistance = getSpeedsByDistance();
            const smashByDistance = getSmashFactorsByDistance();
            const distanceStats = {};
            for (let d = 1; d <= 3; d++) {
                const speeds = byDistance[d];
                const smashFactors = smashByDistance[d];
                if (speeds.length > 0) {
                    distanceStats[d] = {
                        mean: speeds.reduce((a, b) => a + b, 0) / speeds.length,
                        sd: calculateSD(speeds),
                        count: speeds.length
                    };
                    
                    if (smashFactors.length > 0) {
                        distanceStats[d].smashMean = (smashFactors.reduce((a, b) => a + b, 0) / smashFactors.length).toFixed(2);
                        distanceStats[d].smashSD = calculateSD(smashFactors).toFixed(3);
                    }
                }
            }

            const withinThreshold = overallSD <= level.threshold;
            const successRate = withinThreshold ? 100 : 0;

            const result = {
                date: new Date().toISOString(),
                level: currentLevel,
                levelName: level.name,
                club: club,
                distances: distances,
                allSpeeds: allSpeeds,
                overallMean: overallMean.toFixed(1),
                overallSD: overallSD.toFixed(2),
                smashFactorMean: smashFactorMean,
                smashFactorSD: smashFactorSD,
                distanceStats: distanceStats,
                successRate: successRate,
                withinThreshold: withinThreshold,
                totalShots: allSpeeds.length,
                threshold: level.threshold
            };

            sessionHistory.push(result);
            saveHistory();

            displayResults(result);
        }

        function displayResults(result) {
            document.getElementById('resultsSection').classList.remove('hidden');

            const date = new Date(result.date);
            document.getElementById('sessionLevel').textContent = `Level ${result.level} — ${result.levelName}`;
            document.getElementById('sessionClub').textContent = `${result.club}°`;
            document.getElementById('sessionDistances').textContent = `${result.distances.join(', ')} yards`;
            document.getElementById('sessionDate').textContent = date.toLocaleDateString('en-US', { 
                month: 'long', day: 'numeric', year: 'numeric', 
                hour: '2-digit', minute: '2-digit' 
            });

            const statsGrid = document.getElementById('statsGrid');
            const sdClass = result.overallSD <= result.threshold ? 'success' : 
                           result.overallSD <= result.threshold * 1.5 ? 'warning' : 'danger';

            let distanceStatsHTML = '';
            for (let d = 1; d <= 3; d++) {
                if (result.distanceStats[d]) {
                    const stats = result.distanceStats[d];
                    const distSD = parseFloat(stats.sd);
                    const distClass = distSD <= result.threshold ? 'success' : 
                                     distSD <= result.threshold * 1.5 ? 'warning' : 'danger';
                    
                    let smashInfo = '';
                    if (stats.smashMean) {
                        smashInfo = `<div style="font-size: 0.8125rem; margin-top: 0.375rem; color: var(--text-secondary);">
                            Smash: ${stats.smashMean} (±${stats.smashSD})
                        </div>`;
                    }
                    
                    distanceStatsHTML += `
                        <div class="stat-card">
                            <div class="stat-label">Distance ${d} — ${result.distances[d - 1]} Yards</div>
                            <div class="stat-value">${stats.mean.toFixed(1)} mph</div>
                            <div style="font-size: 0.875rem; margin-top: 0.625rem; color: var(--text-secondary);">
                                SD: <span class="${distClass}" style="font-weight: 600;">${stats.sd.toFixed(2)}</span>
                            </div>
                            ${smashInfo}
                        </div>
                    `;
                }
            }

            let smashFactorCards = '';
            if (result.smashFactorMean !== null) {
                const smashSDClass = result.smashFactorSD <= 0.05 ? 'success' : 
                                    result.smashFactorSD <= 0.08 ? 'warning' : 'danger';
                smashFactorCards = `
                    <div class="stat-card">
                        <div class="stat-label">Average Smash Factor</div>
                        <div class="stat-value">${result.smashFactorMean}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Smash Factor SD</div>
                        <div class="stat-value ${smashSDClass}">${result.smashFactorSD}</div>
                    </div>
                `;
            }

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Overall Mean Speed</div>
                    <div class="stat-value">${result.overallMean} mph</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Standard Deviation</div>
                    <div class="stat-value ${sdClass}">${result.overallSD} mph</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Target Threshold</div>
                    <div class="stat-value">≤ ${result.threshold} mph</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Shots</div>
                    <div class="stat-value success">${result.totalShots}</div>
                </div>
                ${smashFactorCards}
                ${distanceStatsHTML}
            `;

            let assessment;
            if (result.withinThreshold) {
                assessment = {
                    type: 'passed',
                    title: 'Excellent Consistency',
                    message: `Your standard deviation of ${result.overallSD} mph meets the ${result.threshold} mph threshold for Level ${currentLevel}. Complete one additional session within threshold to advance to Level ${currentLevel + 1}.`
                };
            } else if (result.overallSD <= result.threshold * 1.5) {
                assessment = {
                    type: 'conditional',
                    title: 'Approaching Target',
                    message: `Your standard deviation of ${result.overallSD} mph is close to the ${result.threshold} mph threshold. Continue practicing at this level to build greater consistency.`
                };
            } else {
                assessment = {
                    type: 'failed',
                    title: 'Additional Practice Recommended',
                    message: `Your standard deviation of ${result.overallSD} mph exceeds the ${result.threshold} mph threshold. Consider returning to Level ${Math.max(1, currentLevel - 1)} to rebuild fundamental consistency. Focus on maintaining identical swing tempo across all distances.`
                };
            }

            const assessmentDiv = document.getElementById('assessmentDiv');
            assessmentDiv.innerHTML = `
                <div class="assessment ${assessment.type}">
                    <h3>${assessment.title}</h3>
                    <p>${assessment.message}</p>
                </div>
            `;

            displayHistory();
        }

        function displayHistory() {
            const sortedHistory = [...sessionHistory].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );

            if (sortedHistory.length > 0) {
                document.getElementById('historyCard').classList.remove('hidden');
                
                const historyList = document.getElementById('historyList');
                historyList.innerHTML = sortedHistory.map(session => {
                    const sdClass = session.overallSD <= session.threshold ? 'success' : 
                                   session.overallSD <= session.threshold * 1.5 ? 'warning' : 'danger';
                    const date = new Date(session.date);
                    const levelName = session.levelName || LEVELS[session.level - 1].name;
                    
                    let smashInfo = '';
                    if (session.smashFactorMean !== null) {
                        smashInfo = ` • Smash: ${session.smashFactorMean} (±${session.smashFactorSD})`;
                    }
                    
                    return `
                        <li class="history-item">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.875rem; margin-bottom: 0.375rem;">
                                    <span style="background: white; padding: 0.375rem 0.875rem; border-radius: 2px; font-size: 0.75rem; font-family: 'Cormorant Garamond', serif; color: var(--forest); font-weight: 600; border: 1px solid var(--border-light);">
                                        L${session.level}
                                    </span>
                                    <div class="date">${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} • ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                                </div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.375rem;">
                                    ${session.club}° @ ${session.distances.join(', ')} yards • Mean: ${session.overallMean} mph • SD: ${session.overallSD} mph${smashInfo}
                                </div>
                            </div>
                            <div class="success-rate ${sdClass}">${session.withinThreshold ? '✓' : '✗'}</div>
                        </li>
                    `;
                }).join('');
            }
        }

        function resetSession() {
            for (let d = 1; d <= 3; d++) {
                for (let s = 0; s < 5; s++) {
                    const input = document.getElementById(`d${d}shot${s}`);
                    input.value = '';
                    input.classList.remove('success', 'failure');
                    
                    const smashSelect = document.getElementById(`d${d}smash${s}`);
                    smashSelect.value = '';
                }
            }
            document.getElementById('resultsSection').classList.add('hidden');
        }
    </script>
</body>
</html>